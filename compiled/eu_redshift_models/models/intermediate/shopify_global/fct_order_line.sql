 

with final as (

SELECT 
      _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_de"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'Base')
  
   
UNION all

SELECT 
      _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_at"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'AT')
  
   
UNION all

 SELECT 
   _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_fr"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'FR')
  
   
UNION all

 SELECT 
 _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_nl"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'NL')
  

UNION all

 SELECT 
    _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_ch"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'CH')
  
   
UNION all

 SELECT 
     _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_uk"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'UK')
  
   
UNION all

 SELECT 
     _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_it"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'IT')
  

   UNION all

 SELECT 
    _fivetran_synced,
     creation_date,
     destination_location_address_1,
     destination_location_address_2,
     destination_location_city,
     destination_location_country_code,
     destination_location_id,
     destination_location_name,
     destination_location_province_code,
     destination_location_zip,
     fulfillable_quantity,
     fulfillment_service,
     fulfillment_status,
     gift_card,
     grams,
     id,
     index,
     name,
     order_id,
     origin_location_address_1,
     origin_location_address_2,
     origin_location_city,
     origin_location_country_code,
     origin_location_id,
     origin_location_name,
     origin_location_province_code,
     origin_location_zip,
     pre_tax_price,
     pre_tax_price_chf,
     pre_tax_price_gbp,
	 pre_tax_price_sek,
    null as pre_tax_price_usd,
     pre_tax_price_set,
     price,
     price_chf,
     price_gbp,
	 price_sek,
    null as price_usd,
     price_set,
     product_exists,
     product_id,
     properties,
     quantity,
     requires_shipping,
     sku,
     tax_code,
     taxable,
     title,
     total_discount,
     total_discount_chf,
     total_discount_gbp,
	 total_discount_sek,
    null as total_discount_usd, 
     total_discount_set,
     variant_id,
     variant_inventory_management,
     variant_title,
     vendor,
     shopify_shop,
    currency_abbreviation,
	conversion_rate_eur,
  null as groupid,	
  null as groupprice,	
  null as grouptype,	
  null as groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_se"
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '1900-01-01' else max("_fivetran_synced") end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'SE')
  

   UNION all

 SELECT 
    kk._fivetran_synced,
     kk.creation_date,
     kk.destination_location_address_1,
     kk.destination_location_address_2,
     kk.destination_location_city,
     kk.destination_location_country_code,
     kk.destination_location_id,
     kk.destination_location_name,
     kk.destination_location_province_code,
     kk.destination_location_zip,
     kk.fulfillable_quantity,
     kk.fulfillment_service,
     kk.fulfillment_status,
     kk.gift_card,
     kk.grams,
     kk.id,
     kk.index,
     kk.name,
     kk.order_id,
     kk.origin_location_address_1,
     kk.origin_location_address_2,
     kk.origin_location_city,
     kk.origin_location_country_code,
     kk.origin_location_id,
     kk.origin_location_name,
     kk.origin_location_province_code,
     kk.origin_location_zip,
     kk.pre_tax_price,
     kk.pre_tax_price_chf,
     kk.pre_tax_price_gbp,
	 kk.pre_tax_price_sek,
    kk.pre_tax_price_usd,
     kk.pre_tax_price_set,
     kk.price,
     kk.price_chf,
     kk.price_gbp,
	 kk.price_sek,
    kk.price_usd,
     kk.price_set,
     kk.product_exists,
     kk.product_id,
     kk.properties,
     kk.quantity,
     kk.requires_shipping,
     kk.sku,
     kk.tax_code,
     kk.taxable,
     kk.title,
     kk.total_discount,
     kk.total_discount_chf,
     kk.total_discount_gbp,
	 kk.total_discount_sek,
    kk.total_discount_usd, 
     kk.total_discount_set,
     kk.variant_id,
     kk.variant_inventory_management,
     kk.variant_title,
     kk.vendor,
     kk.shopify_shop,
    kk.currency_abbreviation,
	kk.conversion_rate_eur,
  kk.groupid,	
  kk.groupprice,	
  kk.grouptype,	
  kk.groupitemtype
   FROM "airup_eu_dwh"."shopify_global"."order_line_us" kk
   
            -----incremental table macro---
  
  where _fivetran_synced >= (select case when max(_fivetran_synced) is null then '2022-06-28' else dateadd(hour, -14 ,max("_fivetran_synced")::timestamp) end from "airup_eu_dwh"."shopify_global"."fct_order_line" where 1=1 and shopify_shop = 'US')
  


)

select *
from final